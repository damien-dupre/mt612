---
title: "MT612 - Advanced Quant. Research Methods"
subtitle: "Lecture 7: PCA, EFA, CFA, and Structural Equation Models"
author: "Damien Dupr√©"
date: "Dublin City University"
output:
  xaringan::moon_reader:
    css: ["default", "metropolis", "metropolis-fonts", "css/custom_design.css"]
    lib_dir: libs
    nature:
      beforeInit: "libs/cols_macro.js"
      highlightStyle: zenburn
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include = FALSE}
# libraries --------------------------------------------------------------------
library(anicon)
library(countdown)
library(emo)
library(fontawesome)
library(tidyverse)

# general options --------------------------------------------------------------
options(scipen = 999)
set.seed(99)

# chunk options ----------------------------------------------------------------
opts_chunk$set(
  cache.extra = rand_seed, 
  message = FALSE, 
  warning = FALSE, 
  error = FALSE, 
  echo = FALSE,
  cache = FALSE,
  comment = "", 
  fig.align = "center", 
  fig.retina = 3
  )
```


---
class: inverse, mline, center, middle

# 1. Principal Component Analysis (PCA)

---
class: inverse, mline, center, middle

# 2. Exploratory Factor Analysis (EFA)

---
class: inverse, mline, center, middle

# 3. Confirmatory Factor Analysis (CFA)

---

# Introduction to CFA

CFA and EFA are used to test a factor structure for a set of variables
- EFA is used when we have no fixed idea of our factor structure
- CFA is used to test a particular factor structure by testing how well our proposed factor structure fits the data

Like EFA, CFA is a latent variable model in which observed variables serve as **indicators** of underlying latent factors. However, unlike EFA, only specific loadings related to the specific items used to estimate the corresponding latent variable are included in the model

---

# Introduction to CFA

```{r}
include_graphics("img/Example CFA model 2 factors v2.png")
```

---

# Introduction to CFA

A CFA can estimate 4 types of parameters:
- Latent factor variances and covariances (the variability of and associations between the latent factors)
- Factor loadings (regression of the latent variables on the observed variables)
- Residual variances (variance in the observed variables not explained by the latent variables)
- Residual covariances (the covariances between observed variables that exist over and above their covariance due to their shared relation with a latent factor)

CFAs involve finding (or specifying) values for all of these parameters

---

# Introduction to CFA

Latent variable scaling is a key aspect of model specification

Because Latent variables have no inherent scale, so we have to define one. There are two commonly used scaling methods:
- Method 1: Fix the variance of each latent variable to 1
- Method 2: Fix one factor loading for each latent variable to 1

Note that the necessity of scaling also applies to the residual factors so typically uses Method 2

---

# Interpreting a CFA

To aid interpretation we can request a fully **standardised solution**. It converts loadings/covariances to a correlation metric

Thereafter, the interpretation is similar to EFA:
- Loadings tell us strength of association between latent factor and items
- Factor correlations tell us how strongly associated latent factors are

---

# Cautions regarding CFA

- Good fit doesn't guarantee that the model is 'correct'
- Be careful about 'reifying' latent variables
- Even when there are no common factors, CFA models can fit well

---
class: title-slide, middle

## CFA with R

---

# CFA with R

```{r echo=TRUE}
model <- '
  latent_variable_1 =~ item1 + item2 + item3 + item4 + item5
  
  latent_variable_2 =~ item6 + item7 + item8 + item9 + item10
   
   latent_variable_1 ~~ latent_variable_2
'
```

To estimate the model, we then feed the object we just created into the `cfa()` function

Lavaan will compute the variance-covariance matrix internally

```{r echo=TRUE, eval=FALSE}
cfa_results <- cfa(model, data = cfa_data)
```

---

# CFA with R

By default, `cfa()` will scale the latent variables by fixing the first indicator for each latent factor to 1

To override this and fix latent factor variances instead, we can write:

```{r echo=TRUE, eval=FALSE}
cfa_results <- cfa(model, data = cfa_data, std.lv = TRUE)
```

---

# CFA with R

We can check the model fit using the `summary()` function:

```{r echo=TRUE, eval=FALSE}
summary(cfa_results, fit.measures = TRUE)
```

We can examine local mis-specifications using the `modindices()` function

```{r echo=TRUE, eval=FALSE}
modindices(cfa_results, sort = TRUE)
```

We can also inspect the standardised parameter estimates

```{r echo=TRUE, eval=FALSE}
summary(cfa_results, standardized = TRUE)
```

---

# CFA with R

`semPaths()` from the {semPlot} package can be used to visual a model as a SEM diagram

```{r echo=TRUE, eval=FALSE}
semPaths(cfa_results, what = "stand")
```

---
class: inverse, mline, left, middle

<img class="circle" src="https://github.com/damien-dupre.png" width="250px"/>

# Thanks for your attention and don't hesitate if you have any questions!

- [`r fa(name = "twitter")` @damien_dupre](http://twitter.com/damien_dupre)
- [`r fa(name = "github")` @damien-dupre](http://github.com/damien-dupre)
- [`r fa(name = "link")` damien-datasci-blog.netlify.app](https://damien-datasci-blog.netlify.app)
- [`r fa(name = "paper-plane")` damien.dupre@dcu.ie](mailto:damien.dupre@dcu.ie)